\label{focal}
\section{Постановка задачи}
Из оцененных фундаментальных матриц можно извлечь фокусное расстояние. Один из методов это сделать описан в статье \cite{Sturm:2005:FLC:1090456.1649082}. В нем строятся два линейных и одно квадратное уравнение относительно квадрата фокусного расстояния --- $f^2$, обозначим эти уравнения за $a\left(f^2\right), b\left(f^2\right), h\left(f^2\right)$. Этот метод позволяет получить  оценку фокусного расстояния для каждой пары в отдельности, мы несколько модифицируем его. 

Пусть у нас есть $F_1, \cdots F_k$ --- оценки фундаментальных матриц для $k$ пар, и из них получены $a_i, b_i, h_i$. 
Рассмотрим:
\begin{equation}
	h^2 = \sum\limits_{i=1}^{k} h^2_i.
\end{equation} 
и уравнение 
\begin{equation}
	\frac{\mathrm{d} h^2}{\mathrm{d}f^2} = 2hh' = 0.
\end{equation} 
Очевидно, при точных оценках на $F_i$  одним из его корней является $f^2$. Найдем все положительные (строго отделенные от нуля) вещественные корни такого уравнения и выберем из них тот, который ко всему прочему минимизирует сумму $\sum\limits_{i=1}^{k} a_i^2 + b_i^2$. Этот подход позволяет оценить $f^2$ сразу совместно по всем фундаментальным матрицам, однако требует, чтобы все оценки $F_k$ были достаточно близкими к правде. Если этого не получается обеспечить, то надо использовать какую-нибудь робастную оценку типа медианы для выборки из оценок $f^2$ для каждой пары.
\section{Реализация}
Реализацию можно увидеть \href{https://github.com/QuantumMechanicus/camera_calibration_test/blob/dev/subroutines/focal_length_estimator/Focal_Estimator.cpp}{здесь}.
